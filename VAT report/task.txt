Your task is to implement class CVATRegister, which implements a simple tax revenue database.

We assume the database holds information about all companies that are obligated to pay the VAT. To reduce tax evasion, a company is obligated to report all invoices in the database. Each company is identified by its tax ID. The IDs are strings and are unique in the database. Second, companies may be positively identified by their names and addresses. We assume the pair (name, address) is unique in the database. That is, there may exist several companies with the same name (e.g. "ACME"), there may be many companies registered with the same address (e.g. "Prague"), however, there may be at most one company "ACME" registered in "Prague". Moreover, tax IDs are compared case sensitive, whereas names and addresses are compared case insensitive.

The class shall implement public interface shown below. The interface consists of:

A constructor (without parameters). This constructor initializes a new empty database.
Destructor -- it shall free all resources used by the instance.
Method newCompany (name, addr, id ) which adds a new record to the database. The parameters are name, address and tax id of the company being registered. The method returns true if it succeeds, or false if it fails (the pair name, addr is already present in the database, or the id is not unique in the database).
Method cancelCompany (name, addr) / cancelCompany (id) removes the corresponding record from the database, the record is identified either by the name and address, or by its tax id. The method returns true if it succeeds, or false if it fails (the corresponding record was not present).
Methods invoice (name, addr, amount) / invoice ( id, amount ) add amount to the income of some company. There are two variants of the method: the company is either identified directly by tax id, or by company name and address. The methods return true if they succeed, or false if they fail (the corresponding record was not found).
Method audit ( name, addr, sum ) / audit ( id, sum ) searches the database for the record identified by name and address, or by tax id. The method fills the output parameter (sum) with the total revenue of the particular company. The method returns true if it succeeds, or false if it fails (the corresponding record was not found). Moreover, if the method fails, the output parameters shall be left unmodified.
Method medianInvoice () searches for the median amount in the registered invoices. Only positively registered invoices are included in the computation, i.e. failed invocations of invoice do not participate in the median. On the other hand, all so-far registered invoices participate in the median computation (including invoices from erased companies). If the number of invoices is even, the result will be the greater of the two middle values. If there are no invoices registered yet, the result is zero.
Metods firstCompany ( name, addr ) / nextCompany ( name, addr ) are used to iterate over the list of companies in our database. The companies are returned in an alphabetical order, sorted by company name. If some companies have the same name, then the company with lexicographically smaller address goes first. Method firstCompany finds the first company in the list. If the list of companies is empty, the method returns false. Otherwise, the method returns true and fills-in output parameters name and addr. Method nextCompany is similar; it finds the company that follows company identified by name and addr from the parameters. If there is not any further company in the list, then nextCompany returns false. Otherwise it returns true and updates the parameters name and addr with the name/address of the next company.
Submit a source file with your CVATRegister implementation. The class must follow the public interface below. If there is a mismatch in the interface, the compilation will fail. You may extend the interface and add you auxiliary methods and member variables (both public and private, although private are preferred). The submitted file must include both declarations as well as implementation of the class (the methods may be implemented inline but do not have to). The submitted file shall not contain anything except the class CVATRegister. In particular, if the file contains main, your tests, or any #include definitions, please, keep them in a conditional compile block. Use the attached source as a basis for your implementation. If the preprocessor definitions are preserved, the file maybe submitted to Progtest.

The class is tested in a limited environment -- both memory and running time is limited. The available memory is big enough to store the records. The class does not have to implement a copy constructor or an overloaded operator =. This functionality is not tested in this homework.

Your implementation must be both time and space efficient. A simple linear-time solution will not succeed (it takes more than 5 minutes for the test data). You may assume newCompany and cancelCompany calls are rare compared to the other methods. Thus these two methods may run in linear time. Methods invoice and audit are called very often, thus they must be very efficient (e.g. logarithmic time or amortized constant time). Finally, medianInvoice is not called often in the mandatory tests. Thus the implementation does not have to be very efficient (linear or n log n is fine to pass the mandatory tests), however, much better time complexity is required to pass the bonus test.

Either STL container or dynamic array allocation is required to implement the database. If implemented using the dynamically allocated array, set the initial size of the array to some small value (e.g. one hundred elements). When the array is full, do not increase the size by just one element. The overhead of the resizing would be enormous. Instead, increase the size by e.g. a thousand elements or use a quotient ranging from 1.5 to 2 (better solution).

If STL is used, your implementation does not have to care about the allocation. Caution: only some STL containers are available (see the headers included in the attached source). In particular, map / unordered_map / set / unordered_set / ... are disabled in this homework.

The attached source file lists some basic tests. The tests are quite short, you have to add your own tests. Please note that the tests included in the submitted files are recognized as an integral part of your solution. Thus someone else's tests included in your solution are just another form of cribbing.

Notes:
Code review: a solution of this assignment may be used for code review if assessed 100% in all all mandatory and optinal tests (i.e., your solution does not have to pass the last bonus test). However, this assignment is not very difficult, the code is somewhat short and simple. Therefore, code review of this homework will be more rigorous.
